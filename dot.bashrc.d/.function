#!/bin/bash


__here()
{
    cygpath -wa "$PWD"
}
alias here='__here'


__download_new_file()
{
    local src=$1
    local dst=$2
    local ctime=$(
        LANG=C date --utc --date="10 years ago" +"%a, %d %b %Y %H:%M:%S GMT"
    )
    if [[ -e ${dst} ]]; then
        ctime=$(
            LANG=C date --utc --date=@"$(stat --format='%Y' ${dst})" +"%a, %d %b %Y %H:%M:%S GMT"
        )
    else
        :
    fi
    if which curl >/dev/null 2>&1; then
        local modified=$(
            curl -fsSL -I -H "If-Modified-Since: ${ctime}" -o /dev/null -w %{http_code} ${src}
        )
        if [[ "200" = "${modified}" ]]; then
            curl -fsSL --output ${dst} ${src} >/dev/null 2>&1
        fi
    elif which http >/dev/null 2>&1; then
        http --follow --continue --download --output ${dst} ${src} >/dev/null 2>&1
    else
        :
    fi
    ls -l ${dst}
}
alias download_new_file='__download_new_file '


__online()
{
    local domain=$1
    local port=$2
    domain=${domain:-www.google.com}
    port=${port:-80}
    if ! which tiny-nc >/dev/null 2>&1; then
        return 1
    fi
    tiny-nc -timeout 1s "${domain}" "${port}"
    return $?
}
alias online='__online '


[[ -e "$(dirname $BASH_SOURCE)/go.sh" ]] && source "$(dirname $BASH_SOURCE)/go.sh"
